# Compiled template file (implementation details)

This document describes the **generated Go file** produced by `hbc` from `.hbs` templates: how template file names map to Go symbols, and what the compiler emits.

The generated file starts with `// Code generated by hbc; DO NOT EDIT.` and may include `// Generator version: <version>` when the compiler was run with version info (e.g. from the hbc CLI).

## Template name → Go identifier

The compiler uses the **template name** = file name without `.hbs` (e.g. `main.hbs` → `main`, `blog/post.hbs` → `blog/post`). From that name it derives a **Go identifier** used in function names:

1. Split the name by any character that is **not** a letter or digit (`/`, `_`, `-`, space, etc.).
2. Capitalize the first letter of each part.
3. Concatenate the parts.
4. If the result is empty or starts with a digit, prefix `"Template"`.

| Template file   | Template name   | Go identifier |
|----------------|-----------------|----------------|
| `main.hbs`     | `main`          | `Main`         |
| `header.hbs`   | `header`        | `Header`       |
| `blog/post.hbs`| `blog/post`     | `BlogPost`     |
| `compat_footer.hbs` | `compat_footer` | `CompatFooter` |
| `404.hbs`      | `404`           | `Template404`  |
| `userCard.hbs` | `userCard`      | `UserCard`     |

Two different template names that map to the same Go identifier (e.g. `blog-post` and `blog_post` → `BlogPost`) cause a compile-time error: the compiler reports the conflict.

## Generated API per template

For each template name, the generated package exposes:

| Go symbol | Signature | Description |
|-----------|------------|--------------|
| `renderXxx` | `func(data XxxContext, w io.Writer, root any) error` | Internal: used by partials and by `RenderXxx`. The `root` argument is the root context (same as `data` when rendering the template as entry; when the template is used as a partial, the caller passes its root so that `@root` inside the partial works). Not intended for direct use. |
| `RenderXxx` | `func(w io.Writer, data XxxContext) error` | Renders the template with `data` into `w`. |
| `RenderXxxString` | `func(data XxxContext) (string, error)` | Renders the template with `data` and returns the result as a string. |

Example for `main.hbs` (Go name `Main`):

```go
func renderMain(data MainContext, w io.Writer, root any) error { ... }
func RenderMain(w io.Writer, data MainContext) error { ... }
func RenderMainString(data MainContext) (string, error) { ... }
```

## Structure of the generated file

1. **Package and imports**  
   Generated package name (from `-pkg`), imports for `io`, `strings`, `runtime`, and any helper packages.

2. **Context interfaces and types**  
   Type-safe accessors for template context paths (inferred from template expressions). The compiler emits interface types (e.g. `MainContext`, `MainContextUser`) and optional `XxxContextFromMap` constructors. Names are derived from the template Go identifier and path (e.g. `MainContextUser`, `MainContextItems`).

3. **Partials map**  
   Keys are template names (as in file names without `.hbs`). Values are functions `func(ctx any, w io.Writer, root any) error` (or with `*runtime.Blocks` when using layout blocks). Used when a template contains `{{> partialName }}` with explicit context or hash. When the partial is called with **no arguments and no hash** (e.g. `{{> header}}`), the compiler calls `renderXxx(data, w, root)` with the current context and the caller’s root; when there is an explicit context or hash, it uses the `partials` map so context is converted via `contextMap` and `XxxContextFromMap`. The `root` argument ensures `@root` inside partials resolves to the top-level data (e.g. the main template’s data). Partial context rules: no args → current context; only hash → hash plus keys used in the partial (from current scope); explicit context and/or hash → base context merged with hash.

4. **Functions**  
   For each template: `renderXxx`, `RenderXxx`, `RenderXxxString` as above.

5. **Bootstrap block** (only with `-bootstrap`)  
   See [Bootstrap-generated code](bootstrap-generated.md).

## Summary

- **Template name** = file name without `.hbs`.
- **Go name** = split by non-alphanumeric, capitalize each part, join; if empty or leading digit, prefix `Template`.
- **Public API**: `RenderXxx(w, data)` and `RenderXxxString(data)` with typed context (e.g. `MainContext`); internal `renderXxx` and `partials` are for compiler/runtime use.
