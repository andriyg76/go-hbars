# Bootstrap-generated code (implementation details)

This document describes the **bootstrap block** generated by `hbc -bootstrap`: what code is emitted and what **interface for the developer** it provides.

## When bootstrap is generated

When you run the compiler with `-bootstrap`:

```bash
hbc -in . -out ./templates_gen.go -pkg templates -bootstrap
```

the generated file includes, after the compiled template functions, an extra block of code. The generated package also gains imports for `github.com/andriyg76/go-hbars/pkg/renderer` and `github.com/andriyg76/go-hbars/pkg/sitegen`.

## Generated code (what the file contains)

### 1. `rendererFuncs`

A map from template name (string) to the public render function:

```go
// rendererFuncs maps template names to render functions.
var rendererFuncs = map[string]func(io.Writer, any) error{
    "main":   RenderMain,
    "header": RenderHeader,
    "footer": RenderFooter,
}
```

Keys are the same template names as in your `.hbs` files (e.g. `main`, `header`, `blog/post`). Values are the generated `RenderXxx` functions.

### 2. `NewRenderer()`

Returns a renderer that can be used with `sitegen.NewProcessor` or `sitegen.NewServer`:

```go
// NewRenderer returns a ready-to-use template renderer.
// This renderer can be used with sitegen.NewProcessor or sitegen.NewServer.
func NewRenderer() renderer.TemplateRenderer {
    return sitegen.NewRendererFromFunctions(rendererFuncs)
}
```

### 3. `NewQuickProcessor()`

Creates a processor with default configuration for static site generation:

```go
// NewQuickProcessor creates a processor with default configuration.
// Use this for quick static site generation.
func NewQuickProcessor() (*sitegen.Processor, error) {
    config := sitegen.DefaultConfig()
    renderer := NewRenderer()
    return sitegen.NewProcessor(config, renderer)
}
```

### 4. `NewQuickServer()`

Creates a server with default configuration for development:

```go
// NewQuickServer creates a server with default configuration.
// Use this for quick development server setup.
func NewQuickServer() (*sitegen.Server, error) {
    config := sitegen.DefaultConfig()
    renderer := NewRenderer()
    return sitegen.NewServer(config, renderer)
}
```

## Interface offered to the developer

### `renderer.TemplateRenderer`

Defined in `github.com/andriyg76/go-hbars/pkg/renderer`:

```go
type TemplateRenderer interface {
    Render(templateName string, w io.Writer, data any) error
}
```

- **`NewRenderer()`** returns this interface.
- The processor and server accept `renderer.TemplateRenderer`; they call `Render(templateName, w, data)` to render a page by template name (e.g. `"main"`, `"blog/post"`).

Your code does not implement this interface directly; the generated `NewRenderer()` returns an implementation backed by `rendererFuncs`.

### `*sitegen.Processor`

Returned by **`NewQuickProcessor()`**:

- **`Process() error`** — processes all data files under `Config().DataPath`, writes HTML under `Config().OutputPath`.
- **`Config() *sitegen.Config`** — set `DataPath`, `OutputPath`, `SharedPath`, `RootPath` to match your layout.

Use for static site generation: data files with `_page.template` and `_page.output` are rendered and written to disk.

### `*sitegen.Server`

Returned by **`NewQuickServer()`**:

- **`Start() error`** — starts the HTTP server (blocks).
- **`Config() *sitegen.Config`** — set `Addr`, `DataPath`, `SharedPath`, `RootPath` for the server.

Use for development: URLs map to data files (e.g. `/` → `data/index.json`), and pages are rendered on demand.

### `*sitegen.Config`

Common configuration for both processor and server (obtained via `Config()`):

| Field        | Meaning |
|-------------|---------|
| `RootPath`  | Project root (default: current working directory). |
| `DataPath`  | Directory with JSON/YAML/TOML data files (e.g. `"data"`). |
| `SharedPath`| Directory with shared data merged into every page (e.g. `"shared"`). |
| `OutputPath`| (Processor only) Directory for generated HTML (e.g. `"pages"`). |
| `Addr`      | (Server only) Listen address (e.g. `":8080"`). |

## Typical usage

```go
import templates "myapp/processor/templates"

// Static site
proc, err := templates.NewQuickProcessor()
if err != nil { log.Fatal(err) }
proc.Config().DataPath = "data"
proc.Config().OutputPath = "pages"
if err := proc.Process(); err != nil { log.Fatal(err) }

// Or HTTP server
srv, err := templates.NewQuickServer()
if err != nil { log.Fatal(err) }
srv.Config().DataPath = "data"
srv.Config().Addr = ":8080"
log.Fatal(srv.Start())
```

Bootstrap uses only public packages (`pkg/renderer`, `pkg/sitegen`), so your module can depend on go-hbars from GitHub without importing internal packages.
