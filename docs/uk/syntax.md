# Довідник синтаксису Handlebars

Цей документ описує синтаксис шаблонів Handlebars, який підтримує go-hbars.

**Власні розширення** (includeZero для `{{#if}}`/`{{#unless}}`) описані в [Власні розширення](extensions.md).

## Значення та вирази

**Прості змінні:**
```handlebars
{{user.name}}
{{title}}
```
Виводить значення `user.name` або `title` з поточного контексту, з HTML-екрануванням.

**Сирий вивід (без екранування):**
```handlebars
{{{htmlContent}}}
{{& htmlContent}}
```
Обидва варіанти виводять значення без HTML-екранування. Використовуйте обережно.

**Поточний контекст:**
```handlebars
{{.}}
{{this}}
```
Обидва посилаються на поточний об’єкт контексту.

**Коментарі:**
```handlebars
{{! Це коментар}}
{{!-- Це блоковий коментар --}}
```
Коментарі не потрапляють у вивід.

## Хелпери

**Рядкові хелпери:**
```handlebars
{{upper user.name}}
{{formatDate user.created format="2006-01-02"}}
{{default user.nickname value="(none)"}}
```
Хелпери — це функції, які перетворюють значення. Вони можуть приймати позиційні аргументи та hash-аргументи (пари key=value).

**Hash-аргументи:**
```handlebars
{{truncate description length=50 suffix="..."}}
{{formatNumber price precision=2 separator=","}}
```
Hash-аргументи передаються хелперам останнім аргументом як мапа `runtime.Hash`.

**Підвирази:**
```handlebars
{{upper (lower title)}}
{{formatDate (lookup user "created") format="2006-01-02"}}
```
Вкладені виклики хелперів: результат одного передається як аргумент іншому.

## Партіали

**Базовий партіал (лише поточний контекст):**
```handlebars
{{> header}}
```
Рендерить партіал `header` з **поточним контекстом**. Поточний контекст передається лише коли немає явного аргументу контексту та немає хешу.

**Партіал з явним контекстом:**
```handlebars
{{> userCard user}}
{{> footer . note="thanks"}}
```
Рендерить партіал із заданим контекстом (наприклад `user` або `.`). Хеш-аргументи зливаються з цим контекстом (хеш перезаписує однакові ключі).

**Партіал лише з хешем (без явного контексту):**
```handlebars
{{> footer note="thanks"}}
```
Рендерить `footer` з контекстом, зібраним з **хешу** та **лише тих ключів, які партіал використовує** з поточного scope. Тобто партіал отримує хеш і будь-які інші кореневі шляхи, на які він посилається (наприклад `{{title}}` у партіалі), взяті з поточного контексту.

**Динамічні імена партіалів:**
```handlebars
{{> (lookup . "cardPartial") user}}
```
Ім’я партіала визначається хелпером під час виконання.

## Блокові хелпери

**Умовний рендер (`if`):**
```handlebars
{{#if user.active}}
  Welcome back, {{user.name}}!
{{else}}
  Please activate your account.
{{/if}}
```
Рендерить блок, якщо вираз істинний; інакше рендерить блок `{{else}}`, якщо він є.

**Власне розширення — includeZero:**  
Щоб числовий нуль вважався істинним (наприклад «0 елементів» замість «немає даних»), використовуйте `includeZero=true`:  
`{{#if count includeZero=true}}...{{/if}}`. Деталі в [Власні розширення — includeZero](extensions.md#includezero).

**Блокові параметри для `if`/`unless`:**
```handlebars
{{#if user.active as |active|}}
  Status: {{active}}
{{/if}}
```
Блокові параметри створюють локальну змінну зі значенням умови.

**Скорочення else if:**
```handlebars
{{#if user.role == "admin"}}
  Admin panel
{{else if user.role == "moderator"}}
  Moderator panel
{{else}}
  User panel
{{/if}}
```
Синтаксис `{{else if condition}}` створює вкладені блоки if. Також підтримується `{{elseif condition}}`.

**Інвертована умова (`unless`):**
```handlebars
{{#unless user.active}}
  Please activate your account.
{{/unless}}
```
Рендерить блок, якщо вираз хибний. Підтримуються блокові параметри та else if.

**Зміна контексту (`with`):**
```handlebars
{{#with user}}
  <h1>{{name}}</h1>
  <p>{{role}}</p>
{{else}}
  <p>No user data</p>
{{/with}}
```
Змінює контекст на вказане значення всередині блоку. Якщо значення хибне, рендериться блок `{{else}}`.

**Ітерація (`each`):**
```handlebars
{{#each users}}
  <li>{{name}}</li>
{{else}}
  <li>No users yet.</li>
{{/each}}
```
Перебирає масиви, зрізи або мапи. У блоці `{{this}}` або `{{.}}` — поточний елемент. Якщо колекція порожня, рендериться блок `{{else}}`.

**Блокові параметри:**
```handlebars
{{#each users as |person idx|}}
  {{idx}}: {{person.name}}
{{/each}}
```
Блокові параметри створюють локальні змінні: перший (`person`) — елемент, другий (`idx`) — індекс.

**Блокові параметри для мап:**
```handlebars
{{#each settings as |val key|}}
  {{key}} = {{val}}
{{/each}}
```
Для мап перший параметр — значення, другий — ключ.

**Власні блокові хелпери:**
```handlebars
{{#myHelper arg1 arg2 key=value}}
  Block content
{{else}}
  Inverse content
{{/myHelper}}
```
Будь-який зареєстрований хелпер може використовуватися як блоковий. Хелпер отримує `BlockOptions` з колбеками `Fn` та `Inverse` для рендеру блоку. Блокові хелпери повинні перевіряти наявність `BlockOptions` у аргументах і викликати відповідний колбек.

**Універсальна секція:**  
Будь-який `{{#name}}...{{/name}}`, який не є вбудованим (`if`/`unless`/`with`/`each`) і не зареєстрованим хелпером, трактується як секція: розв’язати `name` з контексту; якщо істинно — рендерити блок з цим значенням як контекстом; інакше рендерити `{{else}}`, якщо є. Ті самі семантики, що в `{{#with name}}...{{/with}}`. Див. [Власні розширення — Універсальна секція](extensions.md#universal-section).

## Шляхи та змінні даних

**Батьківські шляхи:**
```handlebars
{{#each users}}
  {{name}} - {{../title}}
{{/each}}
```
`../` дає доступ до батьківського контексту. Корисно всередині вкладених блоків.

**Змінні даних:**
```handlebars
{{#each items}}
  {{@index}} - {{name}} ({{@first}}/{{@last}})
{{/each}}
```
Спеціальні змінні в певних контекстах:
- `@index` — поточний індекс у циклі `each` (з нуля)
- `@key` — поточний ключ у циклі `each` по мапах
- `@first` — `true`, якщо це перший елемент
- `@last` — `true`, якщо це останній елемент
- `@root` — кореневий контекст (дані верхнього рівня)

**Доступ до кореня:**
```handlebars
{{#with user}}
  {{name}} - {{@root.title}}
{{/with}}
```
`@root` дає доступ до кореневого контексту з будь-якого місця.

## Істинність

Значення вважаються **хибними**, якщо це:
- `nil`
- `false`
- `0` (будь-який числовий нуль)
- `""` (порожній рядок)
- Порожні масиви, зрізи або мапи

Усе інше **істинне**, зокрема:
- Ненульові числа
- Непорожні рядки
- Непорожні масиви/зрізи/мапи
- Об’єкти/структури

## Керування пробілами

**Обрізання пробілів зліва:**
```handlebars
Title: {{~title}}
```
Символ `~` перед виразом обрізає пробіли зліва.

**Обрізання пробілів справа:**
```handlebars
{{name~}}, {{role}}
```
Символ `~` після виразу обрізає пробіли справа.

**Разом:**
```handlebars
{{~name~}}
```
Обрізає пробіли з обох боків.

## Сирі блоки

Сирі блоки не парсяться всередині:
```handlebars
{{{{raw}}}}
  {{this will be output literally}}
  {{#if something}} not parsed {{/if}}
{{{{/raw}}}}
```
Корисно для виводу синтаксису Handlebars або іншого подібного вмісту без обробки.

## Приклади шаблонів

Прості значення та хелпери:
```
Hello {{user.name}}!
{{upper user.role}}
```

Умовний рендер:
```
{{#if user.active}}
  Welcome back, {{user.name}}!
{{else}}
  Please activate your account.
{{/if}}
```

Ітерація з резервним else:
```
{{#each users}}
  <li>{{name}}</li>
{{else}}
  <li>No users yet.</li>
{{/each}}
```

Вкладений контекст з `with` та партіалами:
```
{{#with user}}
  {{> userCard this}}
{{/with}}
```

Динамічні партіали:
```
{{> (lookup . "cardPartial") user}}
```

## Див. також

- **[Власні розширення](extensions.md)** — includeZero для `{{#if}}`/`{{#unless}}`
